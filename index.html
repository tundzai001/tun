<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>this is a gift for u</title>
    <link rel="icon" href="data:,">
    <!-- LINK T·ªöI FILE CSS (B·∫°n s·∫Ω c·∫ßn t·∫°o file style.css ƒë·ªÉ ƒë·ªãnh d·∫°ng giao di·ªán) -->
    <link rel="stylesheet" href="style.css">

    <!-- FONT CH·ªÆ T·ª™ GOOGLE -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">

    <!-- 
      IMPORT MAP: R·∫•t quan tr·ªçng!
      N√≥ cho tr√¨nh duy·ªát bi·∫øt n∆°i ƒë·ªÉ t√¨m c√°c th∆∞ vi·ªán Three.js khi script.js g·ªçi `import ... from 'three'`.
    -->
    <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.164.1/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.164.1/examples/jsm/"
      }
    }
    </script>

    <!-- ======================================================= -->
    <!-- C√ÅC ƒêO·∫†N M√É SHADER (GLSL) -->
    <!-- ======================================================= -->

    <!-- Vertex Shader chung cho hi·ªáu ·ª©ng b·ªÅ m·∫∑t -->
    <script type="x-shader/x-vertex" id="vertexShader">
        varying vec2 vUv;
        void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
    </script>

    <!-- Fragment Shader cho Thi√™n Th·∫°ch R·ª±c L·ª≠a -->
    <script type="x-shader/x-fragment" id="fragmentShader">
        uniform float uTime;
        varying vec2 vUv;

        // H√†m t·∫°o nhi·ªÖu 2D (Perlin Noise-like)
        float random(vec2 st) {
            return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);
        }
        float noise(vec2 st) {
            vec2 i = floor(st);
            vec2 f = fract(st);
            float a = random(i);
            float b = random(i + vec2(1.0, 0.0));
            float c = random(i + vec2(0.0, 1.0));
            float d = random(i + vec2(1.0, 1.0));
            vec2 u = f * f * (3.0 - 2.0 * f);
            return mix(a, b, u.x) + (c - a) * u.y * (1.0 - u.x) + (d - b) * u.y * u.x;
        }

        void main() {
            vec2 p = vUv * 5.0;
            float t = uTime * 0.5;
            float n = noise(p + t); // T·∫°o nhi·ªÖu chuy·ªÉn ƒë·ªông
            
            // T·∫°o m√†u s·∫Øc dung nham
            vec3 color = mix(vec3(0.8, 0.2, 0.0), vec3(1.0, 0.9, 0.0), n);
            
            // Th√™m c√°c ƒë∆∞·ªùng n·ª©t t·ªëi h∆°n
            float cracks = noise(p * 2.0 - t * 0.5);
            if (cracks < 0.2) {
                color *= 0.5;
            }
            
            gl_FragColor = vec4(color, 1.0);
        }
    </script>

    <!-- Fragment Shader D√†nh Ri√™ng Cho M·∫∂T TR·ªúI (s·ª≠ d·ª•ng texture) -->
    <script type="x-shader/x-fragment" id="sunFragmentShader">
        uniform float uTime;
        uniform sampler2D uTexture;
        varying vec2 vUv;

        float random(vec2 st) {
            return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);
        }
        float noise(vec2 st) {
            vec2 i = floor(st);
            vec2 f = fract(st);
            float a = random(i);
            float b = random(i + vec2(1.0, 0.0));
            float c = random(i + vec2(0.0, 1.0));
            float d = random(i + vec2(1.0, 1.0));
            vec2 u = f * f * (3.0 - 2.0 * f);
            return mix(a, b, u.x) + (c - a) * u.y * (1.0 - u.x) + (d - b) * u.y * u.x;
        }

        void main() {
            vec4 baseColor = texture2D(uTexture, vUv);
            vec2 motion = vec2(uTime * 0.05);
            float n = noise((vUv + motion) * 5.0) * 0.4 + noise((vUv - motion) * 8.0) * 0.2;
            gl_FragColor = baseColor * vec4(vec3(1.0 + n * 1.5), 1.0);
        }
    </script>
</head>
<body>
    <!-- Canvas ƒë·ªÉ v·∫Ω th·∫ø gi·ªõi 3D -->
    <canvas id="webgl-canvas"></canvas>

    <!-- Container cho c√°c hi·ªáu ·ª©ng ch·ªØ r∆°i -->
    <div id="galaxy"></div>

    <!-- M√†n h√¨nh t·∫£i -->
    <div id="loading-screen">
        <div class="loading-content">
            <p>Preparing galaxy universe...</p>
            <div class="loading-heart"></div>
            <div class="progress-container">
                <div id="progress-bar"></div>
            </div>
            <span id="progress-text">0%</span>
        </div>
    </div>

    <!-- L·ªõp ph·ªß ban ƒë·∫ßu ƒë·ªÉ b·∫Øt ƒë·∫ßu ph√°t nh·∫°c -->
    <div id="music-overlay">
        <div class="start-prompt">
            <h1>Preparing Galaxy Universe...</h1>
            <p>Click to enter</p>
        </div>
    </div>

    <!-- B·∫£ng ƒëi·ªÅu khi·ªÉn tr√¨nh ph√°t nh·∫°c -->
    <div id="waveform-controls" class="hidden">
        <div id="waveform"></div>
        <div class="player-info">
            <span id="song-title">ƒêang t·∫£i...</span>
            <div class="player-buttons">
                <span id="current-time">0:00</span>
                <button id="prev-btn">¬´</button>
                <button id="play-pause-btn">‚ñ∂</button>
                <button id="next-btn">¬ª</button>
                <button id="favorite-btn">‚ô°</button>
                <span id="duration">0:00</span>
            </div>
        </div>
    </div>
    
    <!-- C√°c n√∫t ƒëi·ªÅu khi·ªÉn n·ªïi -->
    <div class="floating-controls">
        <button id="settings-toggle-btn" class="hidden">‚öôÔ∏è</button>
        <button id="fly-mode-btn" class="hidden">üöÄ</button>
        <button id="special-day-btn" class="hidden">üíå</button>
    </div>
    <!-- WIDGET TH·ªúI TI·∫æT (M·ªöI) -->
    <div id="weather-widget-container" class="floating-controls hidden">
        <button id="weather-toggle-btn">üå¶Ô∏è</button>
        <div id="weather-tooltip">
            <div id="weather-location">Th√†nh ƒê√¥</div>
            <div class="weather-info-row">
                <span>Tr·∫°ng th√°i:</span>
                <span id="weather-condition">ƒêang t·∫£i...</span>
            </div>
            <div class="weather-info-row">
                <span>Nhi·ªát ƒë·ªô:</span>
                <span id="weather-temp">--¬∞C</span>
            </div>
            <div class="weather-info-row">
                <span>Ch·∫•t l∆∞·ª£ng kh√¥ng kh√≠:</span>
                <span id="weather-aqi">--</span>
            </div>
            <div class="weather-info-row">
                <span>Pha m·∫∑t trƒÉng:</span>
                <span id="weather-moon">--</span>
            </div>
            <p id="weather-quote">V≈© tr·ª• n√†y ƒëang ƒë·ªìng b·ªô c√πng c·∫≠u.</p>
        </div>
    </div>

    <!-- B·∫£ng c√†i ƒë·∫∑t -->
    <div id="settings-panel" class="hidden">
        <label for="volume-slider">√Çm l∆∞·ª£ng</label>
        <input type="range" id="volume-slider" min="0" max="1" step="0.05" value="0.5">
    </div>

    <!-- Th·∫ª th√¥ng tin h√†nh tinh -->
    <div id="planet-info-card" class="hidden">
        <h2 id="info-card-title"></h2>
        <p id="info-card-fact"></p>
        <p id="info-card-message"></p>
        <button id="close-info-btn">√ó</button>
    </div>

    <!-- Container cho c√°c b·ª©c th∆∞ -->
    <div id="letter-container" class="hidden">
        <div class="letter-content">
            <!-- N·ªôi dung th∆∞ s·∫Ω ƒë∆∞·ª£c t·∫°o b·ªüi JS -->
        </div>
    </div>

    <!-- L·ªõp ph·ªß cho ch·∫ø ƒë·ªô l√°i phi thuy·ªÅn -->
    <div id="fly-mode-overlay" class="hidden">
        <p id="fly-mode-status"></p>
    </div>
    
    <!-- B·∫£ng h∆∞·ªõng d·∫´n ƒëi·ªÅu khi·ªÉn (s·∫Ω ƒë∆∞·ª£c t·∫°o b·ªüi JS) -->
    <!-- <div id="flight-controls-help"></div> -->
    
    <!-- Hi·ªáu ·ª©ng ch√∫c m·ª´ng sinh nh·∫≠t -->
    <div id="birthday-celebration">
        <p>Happy Birthday!</p>
    </div>

    <!-- C√°c th·∫ª audio -->
    <audio id="bg-music" crossOrigin="anonymous"></audio>
    <audio id="ambient-sound" src="https://treuah.netlify.app/space-ambient.mp3" loop></audio>

    <!-- TH∆Ø VI·ªÜN B√äN TH·ª® BA -->
    <!-- GSAP (cho ho·∫°t ·∫£nh) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <!-- WaveSurfer.js (cho s√≥ng √¢m) -->
    <script src="https://unpkg.com/wavesurfer.js@7"></script>

    <!-- C√ÅC FILE SCRIPT C·ª¶A B·∫†N (QUAN TR·ªåNG: PH·∫¢I L√Ä type="module") -->
    <script type="module" src="data.js"></script>
    <script type="module" src="weather.js"></script>
    <script type="module" src="script.js"></script>
</body>
</html>
