<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Your Little Universe</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    
    <!-- Th∆∞ vi·ªán Leaflet cho b·∫£n ƒë·ªì chuy·∫øn bay -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <!-- Plugin cho Leaflet ƒë·ªÉ t·∫°o animation m√°y bay -->
    <script src="https://cdn.jsdelivr.net/npm/leaflet.animatedmarker@1.0.0/src/AnimatedMarker.min.js"></script>

</head>
<body>
    <!-- ========= PH·∫¶N N·ªÄN V√Ä 3D ========= -->
    <canvas id="webgl-canvas"></canvas>
    <div id="galaxy"></div>
    <audio id="ambient-sound" src="https://treuah.netlify.app/space-ambient.mp3" loop></audio>

    <!-- ========= M√ÄN H√åNH CH·ªú ========= -->
    <div id="loading-screen">
        <div class="loading-content">
            <div class="loading-heart"></div>
            <p>Preparing Your Galaxy...</p>
            <div class="progress-container">
                <div id="progress-bar"></div>
            </div>
            <p id="progress-text">0%</p>
        </div>
    </div>

    <!-- ========= L·ªöP PH·ª¶ B·∫ÆT ƒê·∫¶U NH·∫†C ========= -->
    <div id="music-overlay">
        <div class="start-prompt">
            <h1>Our Little Universe</h1>
            <p>ch·∫°m ƒë·ªÉ b∆∞·ªõc v√†o</p>
        </div>
    </div>

    <!-- ========= C√ÅC TH√ÄNH PH·∫¶N GIAO DI·ªÜN CH√çNH ========= -->
    
    <!-- WIDGET TH·ªúI TI·∫æT -->
    <div id="weather-widget-container" class="floating-controls hidden">
        <button id="weather-toggle-btn">üå¶Ô∏è</button>
        <div id="weather-tooltip">
            <div id="weather-location">Th√†nh ƒê√¥</div>
            <div class="weather-info-row">
                <span>T√¨nh tr·∫°ng:</span>
                <span id="weather-condition">ƒêang t·∫£i...</span>
            </div>
            <div class="weather-info-row">
                <span>Nhi·ªát ƒë·ªô:</span>
                <span id="weather-temp">--¬∞C</span>
            </div>
            <div class="weather-info-row">
                <span>Ch·∫•t l∆∞·ª£ng kh√¥ng kh√≠:</span>
                <span id="weather-aqi">T·ªët</span>
            </div>
             <div class="weather-info-row">
                <span>Pha m·∫∑t trƒÉng:</span>
                <span id="weather-moon">TrƒÉng non</span>
            </div>
            <p id="weather-quote">"D√π th·ªùi ti·∫øt c√≥ ra sao, t√¨nh y√™u c·ªßa t·ªõ v·∫´n lu√¥n ·ªü ƒë√¢y."</p>
        </div>
    </div>

    <!-- C√ÅC N√öT ƒêI·ªÄU KHI·ªÇN -->
    <div class="floating-controls">
        <button id="settings-toggle-btn" class="hidden">‚öôÔ∏è</button>
        <button id="fly-mode-btn" class="hidden">üöÄ</button>
        <button id="special-day-btn" class="hidden">üíå</button>
    </div>
    
    <!-- B·∫¢NG C√ÄI ƒê·∫∂T -->
    <div id="settings-panel" class="hidden">
        <label for="volume-slider">√Çm l∆∞·ª£ng:</label>
        <input type="range" id="volume-slider" min="0" max="1" step="0.05" value="0.7">
    </div>

    <!-- TH·∫∫ TH√îNG TIN H√ÄNH TINH -->
    <div id="planet-info-card" class="hidden">
        <button id="close-info-btn">&times;</button>
        <h2 id="info-card-title">H√†nh tinh</h2>
        <p id="info-card-fact">ƒê√¢y l√† m·ªôt s·ª± th·∫≠t th√∫ v·ªã.</p>
        <p id="info-card-message">ƒê√¢y l√† l·ªùi nh·∫Øn g·ª≠i ƒë·∫øn c·∫≠u.</p>
    </div>

    <!-- TR√åNH PH√ÅT NH·∫†C -->
    <div id="waveform-controls" class="hidden">
        <div id="waveform"></div>
        <div class="player-info">
            <p id="song-title">Ch·ªçn m·ªôt b√†i h√°t...</p>
            <div class="player-buttons">
                <span id="current-time">0:00</span>
                <button id="prev-btn">‚èÆ</button>
                <button id="play-pause-btn">‚ñ∂</button>
                <button id="next-btn">‚è≠</button>
                <button id="favorite-btn">‚ô°</button>
                <span id="duration">0:00</span>
            </div>
        </div>
        <audio id="bg-music" crossorigin="anonymous"></audio>
    </div>

    <!-- KHUNG ƒê·ªåC TH∆Ø -->
    <div id="letter-container" class="hidden">
        <div class="letter-content">
            <!-- N·ªôi dung th∆∞ s·∫Ω ƒë∆∞·ª£c JS ch√®n v√†o ƒë√¢y -->
        </div>
    </div>

    <!-- ========= C√ÅC L·ªöP PH·ª¶ CHO S·ª∞ KI·ªÜN ƒê·∫∂C BI·ªÜT ========= -->

    <!-- L·ªöP PH·ª¶ CH·∫æ ƒê·ªò BAY -->
    <div id="fly-mode-overlay" class="hidden">
        <p id="fly-mode-status">ƒê√£ b·∫≠t ch·∫ø ƒë·ªô bay</p>
    </div>
    <div id="flight-controls-help" style="display: none;"></div>


    <!-- L·ªöP PH·ª¶ SINH NH·∫¨T -->
    <div id="birthday-celebration">
        <p>Ch√∫c m·ª´ng sinh nh·∫≠t c·∫≠u!</p>
    </div>

    <!-- L·ªöP PH·ª¶ NG√ÄY BAY -->
    <button id="flight-day-btn" class="hidden">M·ªôt h√†nh tr√¨nh ƒë·∫∑c bi·ªát...</button>
    <div id="flight-overlay">
        <div id="flight-map"></div>
        <div id="flight-notification" class="hidden">
            <p>B·∫°n c√≥ m·ªôt l√° th∆∞ t·ª´ ng∆∞·ªùi th∆∞∆°ng...</p>
            <button id="read-flight-letter-btn">ƒê·ªçc ngay</button>
        </div>
    </div>

    <!-- ========= SHADER SCRIPTS (D√ôNG CHO THREE.JS) ========= -->
    <script type="x-shader/x-vertex" id="vertexShader">
        uniform float uTime;
        varying vec2 vUv;
        void main() {
            vUv = uv;
            vec3 pos = position;
            float displacement = sin(pos.x * 5.0 + uTime * 0.5) * 0.1 + cos(pos.y * 5.0 + uTime * 0.5) * 0.1;
            pos += normal * displacement;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
        }
    </script>
    <script type="x-shader/x-fragment" id="fragmentShader">
        uniform float uTime;
        varying vec2 vUv;
        void main() {
            float time = uTime * 0.5;
            vec2 uv = vUv * 2.0 - 1.0;
            vec2 uv0 = uv;
            float i0 = 1.0;
            float i1 = 1.0;
            float i2 = 1.0;
            float i4 = 0.0;
            for (int s = 0; s < 7; s++) {
                vec2 r;
                r = vec2(cos(uv.y * i0 - i4 + time / i1), sin(uv.x * i0 - i4 + time / i1)) / i2;
                r += vec2(-r.y, r.x) * 0.3;
                uv.xy += r;
                i0 *= 1.93;
                i1 *= 1.15;
                i2 *= 1.7;
                i4 += 0.05 + 0.1 * time * i1;
            }
            float r = sin(uv.x - time) * 0.5 + 0.5;
            float b = sin(uv.y + time) * 0.5 + 0.5;
            float g = sin((uv.x + uv.y + sin(time)) * 0.5) * 0.5 + 0.5;
            gl_FragColor = vec4(r, g, b, 1.0);
        }
    </script>
     <script type="x-shader/x-fragment" id="sunFragmentShader">
        uniform float uTime;
        uniform sampler2D uTexture;
        varying vec2 vUv;
        void main() {
            vec2 uv = vUv;
            float noise = (texture2D(uTexture, uv + uTime * 0.01).r + texture2D(uTexture, uv - uTime * 0.01).b) / 2.0;
            float colorNoise = clamp(noise * 3.0, 0.0, 1.0);
            vec3 baseColor = vec3(1.0, 0.6, 0.2);
            vec3 finalColor = baseColor + colorNoise * vec3(0.5, 0.2, 0.0);
            gl_FragColor = vec4(finalColor, 1.0);
        }
    </script>
    

    <!-- ========= C√ÅC TH∆Ø VI·ªÜN JAVASCRIPT ========= -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.158.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.158.0/examples/jsm/"
        }
    }
    </script>

    <!-- C√°c th∆∞ vi·ªán kh√°c kh√¥ng ph·∫£i module c√≥ th·ªÉ gi·ªØ nguy√™n -->
    <script src="https://unpkg.com/wavesurfer.js@7/dist/wavesurfer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <!-- ========= C√ÅC FILE SCRIPT C·ª¶A D·ª∞ √ÅN ========= -->
    <script src="./data.js" type="module"></script>
    <script src="./weather.js" type="module"></script>
    <script src="./script.js" type="module"></script>
</body>
</html>

